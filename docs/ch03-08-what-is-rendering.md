# レンダリングとは

> 参考: https://nextjs.org/learn/foundations/how-nextjs-works/rendering

Reactで書いたコードをUIのHTML表現に変換するためにはレンダリングが必要です。

レンダリングはサーバー上でもクライアント上でも行われます。
つまりビルド時に前もって行われたり、ランタイム時にリクエストごとに行われることがあります。

Next.jsでは、以下の3種類のレンダリング方式が用意されています。

- サーバーサイドレンダリング
- 静的サイト作成
- クライアントサイドレンダリング

## プリレンダリング

サーバーサイドレンダリングと静的サイト生成は、 外部データの取得とReactコンポーネントのHTMLへの変換が、 結果をクライアントに送信する前に行われる為、プリレンダリングと呼ばれます。

## クライアントサイドレンダリングとプリレンダリング

標準的なReactアプリケーションでは、ブラウザはサーバーから空のHTMLシェルと、 UIを構築する為のJavaScript命令を受け取ります。
これは最初のレンダリング作業がユーザーのデバイスで行われる為、 クライアントサイドレンダリングと呼ばれています。

> Next.jsアプリケーションの特定のコンポーネントに対しては、
> Reactの`useEffect(), useSWR`などのデータ取得フックを選択して、クライアントサイドレンダリングを使用することもできます。

これに対してNext.jsでは、デフォルトで全てのページがプリレンダリングされます。
つまりユーザーの端末上でJavaScriptによってHTMLを生成するのではなく、 あらかじめサーバー上でHTMLを生成しておくことです。

実際にはクライアントサイドレンダリングで完全にレンダリングされるアプリの場合、 レンダリング作業が行われている間、ユーザーには白紙のページが表示されます。
プリレンダリングされたアプリでは、構築されたHTMLがユーザーに表示されるのと比べると、その差は歴然です。

![pre-rendering](https://nextjs.org/static/images/learn/foundations/pre-rendering.png)

次に2種類のプリレンダリングについて説明します。

## サーバーサイドレンダリング

サーバーサイドレンダリングでは、リクエストごとにサーバー上でページのHTMLが生成されます。
生成された`HTML, JSON, JavaScript`ファイルは、 ページをインタラクティブに動かすためにクライアントに送信されます。

クライアントサイドでは、HTMLを使ってインタラクティブでないページを高速で表示し、
ReactではJSONデータとJavaScriptの命令を使ってコンポーネントをインタラクティブにします。
この処理をハイドレーションと呼びます。

Next.jsでは、`getServerSideProps`によって、サーバーサイドレンダリングを選択することが出来ます。

> React18とNext12では、Reactサーバーコンポーネントのアルファ版が導入されています。
> サーバーコンポーネントは完全にサーバー上でレンダリングされ、レンダリングにクライアントサイドのJavaScriptは必要ありません。
>
> また、サーバーコンポーネントにより、開発者は一部のロジックをサーバー上に残し、その結果のみをクライアントに送信することが出来ます。
> これにより、クライアントに送信されるバンドルサイズを削減し、クライアントサイドのレンダリングパフォーマンスを向上させることが出来ます。
>
> 詳細は、[React server components](https://reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html)を参照ください😀

## 静的サイト生成

静的サイト生成では、HTMLはサーバー上で生成されますが、サーバーサイドレンダリングとは異なり、実行時にサーバーは存在しません。
その代わりにコンテンツはアプリケーションのデプロイ時のビルド時に一度生成され、HTMLはCDNに保存され、リクエストごとに再利用されます。

Next.jsでは、`getStaticProps`を利用して静的にページを生成するか選ぶことが出来ます。

> Incremental Static Regenerationを使用すると、サイトを構築した後に静的ページを生成、更新することが出来ます。
> つまりデータが変更された場合でも、サイト全体を再構築する必要がないということです。

Next.jsの優れた点は、静的サイト生成、サーバーサイドレンダリング、クライアントサイドレンダリングなど、ユースケースに最も適したレンダリング方法をページ単位で選択できることです。
特定のユースケースに適したレンダリング方法については、[data fetching docs](https://nextjs.org/docs/basic-features/data-fetching/overview)を参照ください。
